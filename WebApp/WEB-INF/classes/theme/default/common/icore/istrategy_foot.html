
<script src="${static_js_uri}/plugins/echart2/echarts-all.js"></script>
<script type="text/javascript">
	// 基于准备好的dom，初始化echarts图表
	var myChart = echarts.init(document.getElementById('echart_k'));
		
	getStockData("600808");
	
	function getStockData(code){
		$.ajax({
			url : "/etomc2/stockdata?jsoncallback=?",
			contentType : 'text/html;charset=utf-8',

			data : {
				"code" : code,
			},
			success : function(result) {
				//console.log("success" + result);
			},
			error : function(request, textStatus, errorThrown) {
				//alert(textStatus);
			},
			complete : function(request, textStatus) { //for additional info
				var option = request.responseText;
				//console.log("option:" + option);
				
				if(option.length>2){
					var JsonList = JSON.parse(option);
					var DateList=[];					
					var legendName=[];
					var bool = 0;
					var seriesList=[];
					for(var cn in JsonList){
						var Json = JsonList[cn];
						legendName.push(cn);
						var seriesData={};	
						var shList=[];
						seriesData['name'] = cn;
						seriesData['type'] = "k";
						
						for (var k in Json){
							if(k=="_id")continue;
							
							if(bool == 0){
								sdate = k.replace(/[-]/g, "/");	
								DateList.push(sdate);
							}
							//console.log("sdate:" +sdate );
							var datalist = [];
							 // 开盘，收盘，最低，最高
							datalist.push(Json[k]['open']);
							datalist.push(Json[k]['close']);
							datalist.push(Json[k]['low']);
							datalist.push(Json[k]['high']);
							shList.push(datalist);
						}
						bool = 1;
						seriesData['data'] = shList;
						seriesList.push(seriesData);
					}
				//console.log("seriesList:" +JSON.stringify(seriesList)  );
					
					var JsonOpton =	{
							title : {
								text : ''
							},
							tooltip : {
								trigger : 'axis',
								formatter : function(params) {
									//console.log("params:" +JSON.stringify(params)  );
									var res = "";
									for(var m=0;m<params.length; m++)
									if(params[m]['series']['type']=="k"){
										res = params[0].seriesName + ' ' + params[0].name;
										res += '<br/>  开盘 : ' + params[0].value[0] + '  最高 : '
												+ params[0].value[3];
										res += '<br/>  收盘 : ' + params[0].value[1] + '  最低 : '
												+ params[0].value[2];
									}else{
										res += params[0].seriesName+":"+params[0].value;
									}
									return res;
								}
							},
							legend : {
								data : legendName
							},
							toolbox : {
								show : true,
								feature : {
									mark : {
										show : true
									},
									dataZoom : {
										show : true
									},
									magicType : {
										show : true,
										type : [ 'line', 'bar' ]
									},
									restore : {
										show : true
									}

								}
							},
							dataZoom : {
								show : true,
								realtime : true,
								start : 50,
								end : 100
							},
							xAxis : [
							         
							         {
								type : 'category',
								boundaryGap : true,
								axisTick : {
									onGap : false
								},
								splitLine : {
									show : false
								},
								data : DateList
							} ],
							yAxis : [ {
								type : 'value',
								scale : true,
								boundaryGap : [ 0.01, 0.01 ]
							} ],
							 series : seriesList
						};
			
					  //console.log("JsonOpton:" +JSON.stringify(JsonOpton)  );
					
			    	  myChart.clear();
			    	  myChart.setOption(JsonOpton, true);
			    	  myChart.refresh();
			    	  
				}
			}
		});
	}
</script>


<script type="text/javascript">
	var straListData = "";
	var nowTId=0;
	function istrSelect(i) {
		for (n = 0; n < 5; n++) {
			$("#select_" + n).attr("class", "fa fa-close");
		}

		$("#select_" + i).attr("class", "fa fa-check");

		var name = straListData[i]['title'];
		nowTId = i;
		$("#strategy_name").html(name);

	}

	function getPage(p) {
		$.ajax({
					url : "/etomc2/strapage?jsoncallback=?",
					contentType : 'text/html;charset=utf-8',

					data : {
						"cid" : "1",
						"p" : p
					},
					success : function(result) {
						//console.log("success" + result);
					},
					error : function(request, textStatus, errorThrown) {
						//alert(textStatus);
					},
					complete : function(request, textStatus) { //for additional info
						var option = request.responseText;
						//console.log("option:" + option);
						var Json = JSON.parse(option);
						$("#straPage").html(Json['page']);
						//console.log("option:" + Json['data']);

						straListData = Json['data'];

						var ListHtml = "";
						for (i = 0; i < Json['data'].length; i++) {
							ListHtml += "<tr>" + "<th scope='row'>"
									+ (i + 1)
									+ "</th>"
									+ "<td>"
									+ Json['data'][i]['title']
									+ "</td>"
									+ "<td>"
									+ Json['data'][i]['summary']
									+ "</td>"
									+ "<td>"
									+ Json['data'][i]['income']
									+ "</td>"
									+ "<td>"
									+ Json['data'][i]['integral']
									+ "</td>"
									+ "<td>"
									+ Json['data'][i]['uid']
									+ "</td>"
									+ "<td><button title='Success' class='btn btn-outline btn-success' type='button' onclick='istrSelect("
									+ i
									+ ")'>"
									+ "		<i class='fa fa-close' id='select_"+i+"' name='select_"+i+"'></i> <span class='sr-only'>Success</span>"
									+ "	</button></td>" + "</tr>";
						}

						$("#straList").html(ListHtml);
					}
				});
	}

	jQuery(function($) {
		getPage(1);

	});
	
	
	function Tactics(){
		var code = $("#code_num").val();
		
		$.ajax({
			url : "/etomc2/strapage?jsoncallback=?",
			contentType : 'text/html;charset=utf-8',

			data : {
				"code" : code,
				"" : straListData[i]['']
			},
			success : function(result) {
				//console.log("success" + result);
			},
			error : function(request, textStatus, errorThrown) {
				//alert(textStatus);
			},
			complete : function(request, textStatus) { //for additional info
				var option = request.responseText;
				console.log("option:" + option);
				
			}
		});
		
	}
	</script>

